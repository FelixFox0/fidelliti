!function(t){"use strict";function e(e){var r=this;t.SPFormRegistry=t.SPFormRegistry||{},r.id=e,r.formSelector="#sp-form-"+r.id,r.$form=i(r.formSelector),r.$formMessage=i(r.formSelector+" .sp-message"),r.$formOuter=i(r.formSelector).parent(".form-outer"),r.$submitButton=i(r.formSelector+" button.sp-button"),r.$closeButton=i(r.formSelector+" .sp-btn-close"),r.formHash=r.$form.attr("sp-hash"),r.formType=r.$form.hasClass("sp-form-popup")?"popup":"embed",r.formType=r.$form.hasClass("sp-form-fixed")?"fixed":r.formType,r.inputs={},r.inputsSelector=r.formSelector+" .sp-element-container :input",r.language=r.$form.attr("sp-lang"),r.preparedData={},r.sent=!1,r.showOptions=r.$form.attr("sp-show-options")?JSON.parse(decodeURIComponent(r.$form.attr("sp-show-options"))):{},r.showOptions.amd&&(p="//email.routee.net"),r.submitURL="localhost"===t.location.hostname?u:p,r.submitURL+="/members/forms/jsonp-submit",r.history=new o(r.formHash),r.valid=!0,r.ipInfo={},r.previewMode="forms.sendpulse.com"===t.location.hostname||"forms.routee.net"===t.location.hostname,r.init()}function o(t){var e=this;e.formHash=t,e.all=e.raise()}function r(){}function n(e){new Promise(function(e,o){void 0===t.jQuery?r.loadScript("//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js",function(){i=t.jQuery}).then(function(){e()}):(i=t.jQuery,e())}).then(e)}function s(){var o="localhost"===t.location.hostname?"login.sendpulse.dev":"login.sendpulse.com",n=[],s=i('div.sp-form [name="sform[phone]"]'),p=a();new Promise(function(t,e){s.length>0&&(n.push(r.loadCss("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/css/intlTelInput.css")),n.push(r.loadScript("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/intlTelInput.min.js")),n.push(r.loadScript("//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/utils.js"))),n.push(r.loadCss("//"+o+"/apps/fc3/build/form-defaults.css")),Promise.all(n).then(function(){t()},function(t){console.error("Necessary scripts have not been loaded:",t)})}).then(function(){for(var t=0,o=p.length;t<o;t++)new e(p[t]).run()})}function a(){var t=i("div.sp-form"),e=t.length,o=[];if(!e)throw new Error("SendPulse: Subscription form ID is missing or code is corrupted!");for(var r=0;r<e;r++)o.push(i(t[r]).attr("sp-id"));return o}var i,p="//login.sendpulse.com",u="//login.sendpulse.dev";e.prototype.init=function(){var t=this;return t.$closeButton.on("click",function(e){t.close(e)}),t.$submitButton.prop("disabled",!t.valid),i(t.inputsSelector).each(function(e,o){var r=i(o);r.hideTip=function(){r.hasClass("sp-invalid")&&(this.removeClass("sp-invalid"),this.next(".sp-tip").detach())},r.showTip=function(t){var e=JSON.parse(decodeURIComponent(this.attr("sp-tips")));this.addClass("sp-invalid"),e.hasOwnProperty(t)&&this.after(i("<div/>",{class:"sp-tip sp-invalid",html:e[t]}))},r.on("focus",function(e){t.hideAllTips()}),"sform[phone]"===r.attr("name")&&r.intlTelInput({initialCountry:"auto",separateDialCode:!0,geoIpLookup:function(e){i.get("//ipinfo.io",function(){},"jsonp").always(function(o){t.ipInfo=o;var r=o&&o.country?o.country:"";e(r)})},utilScript:"//cdnjs.cloudflare.com/ajax/libs/intl-tel-input/9.2.4/js/utils.js"}),t.inputs[o.name]=r}),t.$submitButton.off("click").on("click",function(e){t.submit()}),t.previewMode&&(t.$form.removeClass("sp-form-popup"),t.$form.removeClass("sp-form-fixed"),t.$formOuter.removeClass("sp-popup-outer"),t.$closeButton.remove()),t},e.prototype.run=function(){this.show()},e.prototype.hideAllTips=function(){var t=this;for(var e in t.inputs)t.inputs.hasOwnProperty(e)&&t.inputs[e].hasOwnProperty("hideTip")&&t.inputs[e].hideTip()},e.prototype.disableInputs=function(){var t=this;i(t.inputsSelector).prop("disabled",!0),t.$submitButton.prop("disabled",!0)},e.prototype.enableInputs=function(){var t=this;i(t.inputsSelector).prop("disabled",!1),t.$submitButton.prop("disabled",!1)},e.prototype.close=function(t){var e=this;e.$formOuter.addClass("sp-hide"),e.history.getSubmits().length||e.history.addReject((new Date).getTime())},e.prototype.show=function(){function e(t){t=t||.2,t*=1e3,setTimeout(function(){o.$formOuter.addClass("sp-showing"),setTimeout(function(){o.$formOuter.addClass("sp-show")},200),setTimeout(function(){o.$formOuter.removeClass("sp-showing")},400)},t)}var o=this;if(o.$formOuter.removeClass("sp-force-hide"),o.history.addLastShow(),o.previewMode)return void e();if("embed"!==o.formType){if(o.history.getSubmits().length)return;if(o.history.getRejects().length>1)return;if(1===o.history.getRejects().length){var r=(new Date).getTime(),n=(r-o.history.getLastShow())/864e5;if(o.showOptions.repeat>0&&n<o.showOptions.repeat)return}"popup"===o.formType&&function(){switch(o.showOptions.condition){case"onEnter":e(o.showOptions.delay);break;case"onScroll":i(t).scroll(function(){i(t).scrollTop()+i(t).height()===i(document).height()&&e()});break;case"onClose":i(t).on("unload",function(t){t.preventDefault(),e()})}}(),"fixed"===o.formType&&e()}},e.prototype.validateAll=function(){var t=this;t.valid=!0;for(var e in t.inputs)if(t.inputs.hasOwnProperty(e)&&void 0!==t.inputs[e].attr("sp-type")){var o=t.inputs[e],r=t.validate(o);t.valid=t.valid&&r}return t},e.prototype.validate=function(t){var e=this,o=t.attr("sp-type");if(void 0===o)return!0;"sform[phone]"===t.name&&(o="phone");var r=!0,n=t.val();if(t.hideTip(),t.prop("required"))switch(o){case"checkbox":r=t.prop("checked");break;default:r=""!==n}if(!r)return t.showTip("required"),e.$submitButton.prop("disabled",!1),r;if(t.prop("required")&&""===n)return r=!1,t.showTip("required"),e.$submitButton.prop("disabled",!1),r;if(r&&""!==n)switch(o){case"address":case"date":r=!0;break;case"email":r=function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}(n);break;case"phone":t.prop("required")&&(r=function(e){return!!i.trim(t.val())&&t.intlTelInput("isValidNumber")}(t))}return r||t.showTip("wrong"),r},e.prototype.cbSubmit=function(t){var e=this;t.hasOwnProperty("html")&&t.hasOwnProperty("status")&&("success"===t.status?(e.$formMessage.addClass("sp-message-success"),e.sent=!0,e.history.addSubmit()):e.$formMessage.addClass("sp-message-error"),e.$formMessage.html(t.html),e.enableInputs()),e.removeInstanceFromRegistry()},e.prototype.submit=function(){var e=this;if("popup"===e.formType&&e.history.getSubmits().length>1)throw new Error("Form has been submitted twice already. Enough!");e.sent||(e.validateAll(),e.valid&&(e.disableInputs(),e.putInstanceToRegistry(),function(){for(var o in e.inputs)if(e.inputs.hasOwnProperty(o)){var r=e.inputs[o];switch(r.attr("sp-type")){case"phone":e.preparedData[o]=r.intlTelInput("getNumber");break;case"checkbox":r.prop("checked")?e.preparedData[o]=r.val():e.preparedData[o]="no";break;case"radio":e.preparedData[o]=i('[name="'+o+'"]:checked').val();break;default:e.preparedData[o]=r.val()}}e.preparedData.sform_lang=e.language,e.preparedData["sform[hash]"]=e.formHash,e.preparedData["sform["+t.btoa("autoSite")+"]"]=t.location.hostname,i.isEmptyObject(e.ipInfo)||(e.preparedData["sform["+t.btoa("autoIp")+"]"]=e.ipInfo.ip,e.preparedData["sform["+t.btoa("autoCity")+"]"]=e.ipInfo.city,e.preparedData["sform["+t.btoa("autoRegion")+"]"]=e.ipInfo.region,e.preparedData["sform["+t.btoa("autoCountry")+"]"]=e.ipInfo.country)}(),function(){i.ajax({url:e.submitURL+"?callback=?",dataType:"jsonp",data:e.preparedData,jsonpCallback:e.makeCallbackName("cbSubmit")})}()))},e.prototype.makeCallbackName=function(t){return"SPFormRegistry['"+this.formHash+"']."+t},e.prototype.putInstanceToRegistry=function(){var e=this;t.SPFormRegistry[e.formHash]=e},e.prototype.removeInstanceFromRegistry=function(){var e=this;void 0!==t.SPFormRegistry[e.formHash]&&delete t.SPFormRegistry[e.formHash]},o.prototype.raise=function(){var t=this;if(localStorage.hasOwnProperty(t.formHash))try{return JSON.parse(localStorage.getItem(t.formHash))}catch(t){console.error(t)}return{submits:[],rejects:[],lastShow:0}},o.prototype.persist=function(){var t=this;localStorage.setItem(t.formHash,JSON.stringify(t.all))},o.prototype.add=function(t,e){var o=this;switch(e=e||(new Date).getTime(),t){case"submits":case"rejects":o.all[t].push(e);break;case"lastShow":o.all[t]=e}o.persist()},o.prototype.addSubmit=function(t){this.add("submits",t)},o.prototype.addReject=function(t){this.add("rejects",t)},o.prototype.addLastShow=function(t){this.add("lastShow",t)},o.prototype.get=function(t){var e=this;if(e.all.hasOwnProperty(t))return e.all[t]},o.prototype.getSubmits=function(){return this.get("submits")},o.prototype.getRejects=function(){return this.get("rejects")},o.prototype.getLastShow=function(){return this.get("lastShow")},r.loadScript=function(t,e,o){return new Promise(function(r,n){var s=document.createElement("script");void 0===o&&(o=!1),s.type="text/javascript",s.async=!0,s.src=t+(o?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(s),s.readyState?s.onreadystatechange=function(){"loaded"!==s.readyState&&"complete"!==s.readyState||(s.onreadystatechange=null,"function"==typeof e&&e(),r())}:s.onload=function(){"function"==typeof e&&e(),r()},s.onerror=function(){n(new Error("Loading fail! "+t))}})},r.loadCss=function(t,e,o){return new Promise(function(r,n){var s=document.createElement("link");void 0===o&&(o=!1),s.rel="stylesheet",s.media="screen",s.href=t+(o?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(s),s.readyState?s.onreadystatechange=function(){"loaded"!==s.readyState&&"complete"!==s.readyState||(s.onreadystatechange=null,"function"==typeof e&&e(),r())}:s.onload=function(){"function"==typeof e&&e(),r()},s.onerror=function(){n(new Error("Loading fail! "+t))}})},r.loadPromisePolyfill=function(t,e){var o="//polyfill.io/v2/polyfill.min.js?flags=gated,always&features=Promise,&rum=0",r=document.createElement("script");void 0===e&&(e=!1),r.type="text/javascript",r.async=!1,r.src=o+(e?"?t="+(new Date).getTime():""),document.getElementsByTagName("head")[0].appendChild(r),r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,"function"==typeof t&&t())}:r.onload=function(){"function"==typeof t&&t()},r.onerror=function(){throw new Error("Loading fail! "+o)}},t.onload=function(){"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?n(s):r.loadPromisePolyfill(function(){n(s)})}}(window);
//# sourceMappingURL=default-handler.js.map
